<!DOCTYPE html>
<html lang="en">
<!-- [Previous head and style sections remain exactly the same...] -->
<head>
    <!-- [Previous head content remains the same...] -->
</head>
<body>
    <!-- [Previous body content remains the same until the script section...] -->

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwf-sQ5LVhriYEh8gsDr53EDkczVnH2LCeafu_Rj07yz8V3O_5UWNzv6ghlL2Hc4TOo/exec';
        
        let isScanning = false;
        let ndefReader = null;
        let readingHandler = null;
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');

        async function startScanning() {
            if (!('NDEFReader' in window)) {
                alert('WebNFC is not supported in this browser. Please use Chrome on Android.');
                return;
            }

            const trainerName = document.getElementById('trainer-name').value;
            const training = document.getElementById('training-id').value;
            
            if (!trainerName || !training) {
                alert('Please enter both Trainer\'s Name and Training');
                return;
            }

            try {
                await stopScanningInternal();
                
                isScanning = true;
                updateStatus(true);
                updateButtons(true);
                
                ndefReader = new NDEFReader();
                
                readingHandler = ({ serialNumber }) => {
                    if (!isScanning) return;
                    
                    // Updated timestamp to use exact local time
                    const now = new Date();
                    const timestamp = now.toLocaleString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false,
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    });
                    
                    const formattedNfcId = serialNumber
                        .replace(/[^a-fA-F0-9]/g, '')
                        .toUpperCase()
                        .trim();
                    
                    const logEntry = `${now.toLocaleTimeString()} - Trainer: ${trainerName} - Training: ${training} - NFC: ${formattedNfcId}`;
                    
                    addLogEntry(logEntry);
                    
                    sendToServer({
                        timestamp: timestamp,
                        deviceId: trainerName,
                        number: training,
                        nfcId: formattedNfcId
                    });
                };

                ndefReader.addEventListener("reading", readingHandler);
                await ndefReader.scan();
                addLogEntry('Scanning started...', 'system');
                
            } catch (error) {
                handleError(error);
            }
        }

        // [Rest of the code remains exactly the same...]
    </script>
</body>
</html>
